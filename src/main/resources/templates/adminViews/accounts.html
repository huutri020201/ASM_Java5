<!DOCTYPE html>
<html lang="vi" th:replace="~{/layout-admin::view1(~{::title},~{::section})}">
<head>
    <title>Quản lý tài khoản người dùng</title>
</head>
<body>
<section class="container mt-4">
    <h2 class="text-center text-warning mb-4">Quản lý tài khoản người dùng</h2>

    <!-- FORM THÊM / SỬA -->
    <form th:action="@{/admin/accounts/save}" th:object="${account}" method="post" class="card p-4 mb-5 shadow-sm">

        <div class="row g-3">
            <!-- Trong file accounts.html, thay đoạn username bằng cái này -->
            <div class="col-md-6">
                <label class="form-label fw-bold text-smoke">
                    Tên đăng nhập (Username)
                </label>
                <input type="text"
                       th:field="*{username}"
                       class="form-control"
                       required
                       minlength="3"
                       maxlength="20"
                       th:readonly="${account.username != null}"
                       placeholder="Nhập username khi tạo mới">
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold text-smoke">Họ tên</label>
                <input type="text" th:field="*{fullname}" class="form-control">
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold text-smoke">Email</label>
                <input type="email" th:field="*{email}" class="form-control" required>
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold text-smoke">Số điện thoại</label>
                <input type="text" th:field="*{phone}" class="form-control">
            </div>

            <div class="col-md-6">
                <label class="form-label fw-bold text-smoke">Mật khẩu</label>
                <input type="password" th:field="*{password}" class="form-control">
            </div>

            <div class="col-md-3">
                <label class="form-label fw-bold text-smoke">Số dư</label>
                <input type="number" step="0.01" th:field="*{balance}" class="form-control" min="0">
            </div>

            <div class="col-md-3">
                <label class="form-label fw-bold text-smoke">Vai trò</label>
                <select th:field="*{role}" class="form-select">
                    <option value="false">Người dùng thường</option>
                    <option value="true">Quản trị viên</option>
                </select>
            </div>

            <div class="col-md-3">
                <label class="form-label fw-bold text-smoke">Trạng thái</label>
                <select th:field="*{active}" class="form-select">
                    <option value="true">Hoạt động</option>
                    <option value="false">Khóa</option>
                </select>
            </div>

            <div class="col-12 text-center mt-4">
                <button type="submit" class="btn btn-primary px-5">Lưu lại</button>
                <a th:href="@{/admin/accounts}" class="btn btn-secondary px-5 ms-3">Làm mới</a>
            </div>
        </div>
    </form>

    <!-- BẢNG DANH SÁCH TÀI KHOẢN -->
    <div class="table-responsive">
        <table class="table table-hover table-bordered text-center align-middle">
            <thead class="table-dark">
            <tr>
                <th>Username</th>
                <th>Họ tên</th>
                <th>Email</th>
                <th>SĐT</th>
                <th>Số dư</th>
                <th>Vai trò</th>
                <th>Trạng thái</th>
                <th>Ngày tạo</th>
                <th>Hành động</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="acc : ${accountPage.content}">
                <td th:text="${acc.username}"></td>
                <td th:text="${acc.fullname} ?: 'Chưa đặt'"></td>
                <td th:text="${acc.email}"></td>
                <td th:text="${acc.phone} ?: 'Chưa có'"></td>
                <td th:text="${#numbers.formatDecimal(acc.balance, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                <td>
                    <span th:text="${acc.role} ? 'Admin' : 'User'"
                          th:classappend="${acc.role} ? 'badge bg-danger' : 'badge bg-info'"></span>
                </td>
                <td>
                    <span th:text="${acc.active} ? 'Hoạt động' : 'Bị khóa'"
                          th:classappend="${acc.active} ? 'text-success' : 'text-danger fw-bold'"></span>
                </td>
                <td th:text="${#dates.format(acc.createdAt, 'dd/MM/yyyy HH:mm')}"></td>
                <td>
                    <a th:href="@{'/admin/accounts/edit/' + ${acc.username}}"
                       class="btn btn-sm btn-warning">Sửa</a>
                    <a th:href="@{'/admin/accounts/delete/' + ${acc.username}}"
                       class="btn btn-sm btn-danger mt-1"
                       onclick="return confirm('Xóa tài khoản này? Hành động không thể hoàn tác!')">Xóa</a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(accountPage.content)}">
                <td colspan="9" class="text-muted">Không có tài khoản nào</td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- PHÂN TRANG -->
    <nav th:if="${totalPages > 1}" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0 ? 'disabled' : ''}">
                <a class="page-link" th:href="@{/admin/accounts(page=${currentPage - 1})}">Trước</a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${i == currentPage ? 'active' : ''}">
                <a class="page-link" th:href="@{/admin/accounts(page=${i})}" th:text="${i + 1}"></a>
            </li>
            <li class="page-item" th:classappend="${currentPage + 1 >= totalPages ? 'disabled' : ''}">
                <a class="page-link" th:href="@{/admin/accounts(page=${currentPage + 1})}">Sau</a>
            </li>
        </ul>
    </nav>

</section>
</body>
</html>